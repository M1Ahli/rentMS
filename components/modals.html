<div class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm" id="property-modal">
<div class="modal-content modal-glass rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-[fadeIn_0.2s_ease-out]">
<div class="modal-header-glass p-6 border-b bg-gray-50 dark:bg-gray-700 dark:border-gray-600 flex justify-between items-center">
<h3 id="property-modal-title" class="text-xl font-bold">ุฅุถุงูุฉ ุนูุงุฑ ุฌุฏูุฏ</h3>
<button class="text-gray-400 hover:text-gray-600" onclick="closePropertyModal()">โ</button>
</div>
<form class="p-6 grid grid-cols-1 gap-4" id="property-form">
<input class="border p-2 rounded w-full" id="prop-id" placeholder="ุฑูุฒ ุงูุนูุงุฑ (ูุซุงู: PRP001)" required=""/>
<input class="border p-2 rounded w-full" id="prop-name" placeholder="ุงุณู ุงูุนูุงุฑ" required=""/>
<div class="grid grid-cols-2 gap-4">
<input class="border p-2 rounded" id="prop-type" placeholder="ุงูููุน (ูููุง/ุจูุงูุฉ)"/>
<input class="border p-2 rounded" id="prop-usage" placeholder="ุงูุงุณุชุฎุฏุงู"/>
</div>
<input class="border p-2 rounded" id="prop-location" placeholder="ุงููููุน"/>

<div class="modal-actions flex justify-end gap-3 mt-4">
<button class="btn-ui btn-reset" onclick="closePropertyModal()" type="button">ุฅูุบุงุก</button>
<button class="btn-ui btn-success">ุญูุธ</button>
</div>
</form>
</div>
</div>

<div class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm" id="unit-modal">
<div class="modal-content modal-glass rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden">
<div class="modal-header-glass p-6 border-b bg-gray-50 dark:bg-gray-700 dark:border-gray-600">
<h3 class="text-xl font-bold">ุจูุงูุงุช ุงููุญุฏุฉ</h3>
</div>
<form class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4" id="unit-form">
<input id="unit-prop-id" type="hidden"/>
<input id="unit-id" type="hidden"/>
<div class="md:col-span-2">
<label class="text-xs text-gray-500 dark:text-gray-400">ุงุณู ุงููุญุฏุฉ</label>
<input class="border p-2 rounded w-full" id="unit-name" placeholder="ูุซุงู: 10-A"/>
</div>
<div class="md:col-span-2">
<label class="text-xs text-gray-500 dark:text-gray-400">ุฑูู ุงููุญุฏุฉ</label>
<input class="border p-2 rounded w-full font-mono" id="unit-code" placeholder="ูุซุงู: UNT83609"/>
</div>
<div class="md:col-span-2 border-t dark:border-gray-600 pt-4 mt-2">
<p class="font-bold text-gray-700 dark:text-gray-300 mb-2">ุนุฏุงุฏุงุช ุงูุฎุฏูุงุช</p>
</div>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ุฑูู ุนุฏุงุฏ ุงูููุฑุจุงุก</label>
<input class="border p-2 rounded w-full font-mono" id="unit-elec-meter-no" placeholder="ุงุฎุชูุงุฑู"/>
</div>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ุฑูู ุนุฏุงุฏ ุงูููุงู</label>
<input class="border p-2 rounded w-full font-mono" id="unit-water-meter-no" placeholder="ุงุฎุชูุงุฑู"/>
</div>
<div class="md:col-span-2">
<label class="text-xs text-gray-500 dark:text-gray-400">ูุนุฑู ุงูุนูุงุฑ (ุทุงูุฉ)</label>
<input class="border p-2 rounded w-full font-mono bg-gray-50 dark:bg-gray-800 dark:text-gray-100" id="unit-property-id" placeholder="ุงุชุฑูู ูุงุฑุบูุง ุงูุขู (ุณูุชู ุฅุฏุฎุงูู ูุงุญููุง)"/>
</div>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ุงูููุน</label>
<input class="border p-2 rounded w-full" id="unit-type"/>
</div>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ุงูุงุณุชุฎุฏุงู</label>
<input class="border p-2 rounded w-full" id="unit-usage"/>
</div>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ุงูุญุงูุฉ</label>
<select class="border p-2 rounded w-full" id="unit-status">
<option value="ุดุงุบุฑุฉ">ุดุงุบุฑุฉ</option>
<option value="ูุคุฌุฑุฉ">ูุคุฌุฑุฉ</option>
</select>
</div>
<div class="md:col-span-2 border-t dark:border-gray-600 pt-4 mt-2">
<p class="font-bold text-gray-700 dark:text-gray-300 mb-2">ุจูุงูุงุช ุงูุนูุฏ ุงูุญุงูู (ุฅู ูุฌุฏ)</p>
</div>
<div class="md:col-span-2 text-xs text-gray-500 dark:text-gray-400 -mt-2">
          ุณูุชู ุงุนุชูุงุฏ ุงูุงุณู ุจุงูุดูู: <span class="font-semibold" id="unit-display-preview">10-A</span>
</div>
<div class="md:col-span-2">
<input class="border p-2 rounded w-full" id="unit-tenant" placeholder="ุงุณู ุงููุณุชุฃุฌุฑ"/>
</div>
<div>
<input class="border p-2 rounded w-full" id="unit-rent" placeholder="ุงููููุฉ ุงูุฅูุฌุงุฑูุฉ" type="number"/>
</div>
<div>
<input class="border p-2 rounded w-full" id="unit-contractNo" placeholder="ุฑูู ุงูุนูุฏ"/>
</div>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ุจุฏุงูุฉ ุงูุนูุฏ</label>
<input class="border p-2 rounded w-full" id="unit-start" type="date"/>
</div>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ููุงูุฉ ุงูุนูุฏ</label>
<input class="border p-2 rounded w-full" id="unit-end" type="date"/>
</div>
  <div class="md:col-span-2 border border-gray-200 dark:border-gray-700 rounded-xl p-3 bg-white/50 dark:bg-white/5">
    <div class="flex items-center justify-between">
      <div class="text-xs font-bold text-gray-700 dark:text-gray-300">ูุฑููุงุช ุงููุญุฏุฉ</div>
      <button type="button" class="btn-ui btn-ui-sm btn-secondary" onclick="chooseAttachmentsRoot()">ุชุญุฏูุฏ ูุฌูุฏ ุงููุฑููุงุช</button>
    </div>

    <div class="mt-2 flex flex-wrap gap-2 items-center">
      <input class="border p-2 rounded w-full md:w-auto hidden" id="unit-attach-files" type="file" multiple accept="application/pdf,image/*" />
      <button type="button" class="btn-ui btn-ui-sm btn-primary" onclick="uploadUnitModalFiles()">ุฑูุน</button>
      <button type="button" class="btn-ui btn-ui-sm btn-secondary" onclick="openUnitAttachmentsViewerFromModal()">๐ ุนุฑุถ ุงููููุงุช</button>
      <span class="text-[11px] text-gray-500 dark:text-gray-400">ุณูุชู ุญูุธ ุงููููุงุช ุฏุงุฎู Attachments/units/&lt;unit_id&gt;/</span>
    </div>

    <input id="unit-attachments-json" type="hidden" value="[]"/>
    <div id="unit-attachments-list" class="mt-2 space-y-2"></div>
  </div>

<div class="md:col-span-2 flex justify-end gap-3 mt-4 border-t dark:border-gray-600 pt-4">
<button class="btn-ui btn-reset" onclick="closeUnitModal()" type="button">ุฅูุบุงุก</button>
<button class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 shadow">ุญูุธ ุงูุชุบููุฑุงุช</button>
</div>
</form>
</div>
</div>

<div class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm" id="lease-modal">
<div class="modal-content modal-glass rounded-xl shadow-2xl w-full max-w-lg">
<form class="p-6 space-y-4" id="lease-form">
<h3 class="font-bold text-lg mb-4">ุชุนุฏูู ุจูุงูุงุช ุงูุนูุฏ</h3>
<input id="lease-prop-id" type="hidden"/>
<input id="lease-unit-id" type="hidden"/>
<input class="w-full border p-2 rounded" id="lease-tenant" placeholder="ุงููุณุชุฃุฌุฑ" required=""/>
<div class="grid grid-cols-2 gap-2">
<input class="border p-2 rounded" id="lease-phone" placeholder="ุฑูู ุงููุงุชู"/>
<input class="border p-2 rounded" id="lease-email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" type="email"/>
</div>
<div class="grid grid-cols-2 gap-2">
<input class="border p-2 rounded" id="lease-paymentsCount" min="0" placeholder="ุนุฏุฏ ุงูุฏูุนุงุช" type="number"/>
<input class="border p-2 rounded" id="lease-chequesCount" min="0" placeholder="ุนุฏุฏ ุงูุดููุงุช" type="number"/>
</div>
<div class="grid grid-cols-2 gap-2">
<input class="border p-2 rounded" id="lease-bankGuarantee" min="0" placeholder="ูููุฉ ุงูุถูุงู ุงูุจููู" type="number"/>
<select class="border p-2 rounded" id="lease-tenantType">
<option value="">ููุน ุงููุณุชุฃุฌุฑ...</option>
<option value="company">ุดุฑูุฉ</option>
<option value="individual">ูุฑุฏ</option>
</select>
</div>
<div class="hidden" id="lease-companyFields">
<input class="w-full border p-2 rounded" id="lease-tradeLicense" placeholder="ุฑูู ุงูุฑุฎุตุฉ ุงูุชุฌุงุฑูุฉ (ููุดุฑูุงุช)"/>
</div>
<div class="hidden" id="lease-personFields">
<input class="w-full border p-2 rounded" id="lease-idNumber" placeholder="ุฑูู ุงููููุฉ (ููุฃูุฑุงุฏ)"/>
</div>
<div class="grid grid-cols-2 gap-2">
<input class="border p-2 rounded" id="lease-rent" placeholder="ุงููููุฉ" type="number"/>
<input class="border p-2 rounded" id="lease-contractNo" placeholder="ุฑูู ุงูุนูุฏ"/>
</div>
<div class="border border-gray-200 dark:border-gray-700 rounded-xl p-3 bg-white/50 dark:bg-white/5">
  <div class="text-xs font-bold text-gray-700 dark:text-gray-300 mb-2">ูุฑูู ุงูุนูุฏ ุงูููุซู (ุงูุจูุฏูุฉ)</div>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
    <input class="border p-2 rounded" id="lease-municipalityDocName" placeholder="ุงุณู ุงูููู (ุงุฎุชูุงุฑู)"/>
    <div class="flex gap-2">
      <input class="border p-2 rounded w-full" id="lease-municipalityDocPath" placeholder="ูุณุงุฑ/ุฑุงุจุท ุงูููู (ูุซุงู: Attachments/leases/&lt;contract_no&gt;/municipality_contract.pdf)"/>
      <button class="btn-ui btn-ui-sm btn-secondary" type="button" onclick="suggestLeaseMunicipalityPath('lease')">ุงูุชุฑุงุญ</button>
    </div>
    <div class="flex flex-wrap gap-2 items-center mt-2">
      <input class="border p-2 rounded w-full md:w-auto hidden" id="lease-municipalityDocFile" type="file" accept="application/pdf,image/*" />
      <button class="btn-ui btn-ui-sm btn-primary" type="button" onclick="uploadLeaseMunicipalityDoc('lease')">ุฑูุน</button>
      <button class="btn-ui btn-ui-sm btn-secondary" type="button" onclick="chooseAttachmentsRoot()">ุชุญุฏูุฏ ูุฌูุฏ ุงููุฑููุงุช</button>
    </div>

  </div>
  <div class="flex items-center justify-between text-[11px] text-gray-500 dark:text-gray-400 mt-2">
    <span>ูุชู ุญูุธ ุงูููู ุฏุงุฎู ูุฌูุฏ ุงููุฑููุงุช (ูุชุณุฌูู ุงููุณุงุฑ ุชููุงุฆูุงู).</span>
    <div class="flex items-center gap-3">
    <a id="lease-municipalityDocLink" class="text-blue-600 dark:text-blue-400 hover:underline hidden" href="#" target="_blank" rel="noopener">ูุชุญ</a>
    <a class="text-blue-600 dark:text-blue-400 hover:underline" href="#" onclick="openLeaseAttachmentsViewerFromModal('lease'); return false;">ุนุฑุถ ูู ุงููููุงุช</a>
  </div>
  </div>
</div>
<div class="grid grid-cols-2 gap-2">
<div>
<label class="text-xs">ูู</label>
<input class="w-full border p-2 rounded" id="lease-start" type="date"/>
</div>
<div>
<label class="text-xs">ุฅูู</label>
<input class="w-full border p-2 rounded" id="lease-end" type="date"/>
</div>
</div>
<select class="w-full border p-2 rounded" id="lease-status">
<option value="ูุคุฌุฑุฉ">ูุคุฌุฑุฉ</option>
</select>
<div class="flex justify-between pt-4">
<button class="text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/20 px-3 py-1 rounded" onclick="cancelLease()" type="button">ุฅูุบุงุก ุงูุนูุฏ ูุฅุฎูุงุก ุงููุญุฏุฉ</button>
<div class="flex gap-2">
<button class="btn-ui btn-reset" onclick="closeLeaseModal()" type="button">ุฅูุบุงุก</button>
<button class="btn-ui btn-success">ุญูุธ</button>
</div>
</div>
</form>
</div>
</div>

<div class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm" id="add-lease-modal">
<div class="modal-content modal-glass rounded-xl shadow-2xl w-full max-w-5xl">
<form class="p-6 space-y-4" id="add-lease-form">
  <h3 class="font-bold text-xl mb-2 text-right">ุนูุฏ ุฌุฏูุฏ</h3>

  <!-- Tabs -->
  <div class="ui-tabs" id="add-lease-tabs" data-default-tab="units" aria-label="ุชุจููุจุงุช ุนูุฏ ุฌุฏูุฏ">
    <button type="button" class="ui-tab-btn active" data-tab-btn="units">๐ข ุงููุญุฏุงุช</button>
    <button type="button" class="ui-tab-btn" data-tab-btn="tenant">๐ค ุงููุณุชุฃุฌุฑ</button>
    <button type="button" class="ui-tab-btn" data-tab-btn="payments">๐ณ ุงูุฏูุนุงุช/ุงูุดููุงุช</button>
    <button type="button" class="ui-tab-btn" data-tab-btn="contract">๐ ุจูุงูุงุช ุงูุนูุฏ</button>
    <span class="ui-tab-hint">ููุชูุญ ุงูุชุฑุงุถูุงู</span>
  </div>

  <!-- Panel: Units -->
  <div class="space-y-4" data-tab-panel="units">
    <div>
      <label class="text-xs text-gray-500 dark:text-gray-400">ุงูุนูุงุฑ</label>
      <select class="ui-field ui-select w-full" id="add-lease-prop"></select>
    </div>

    <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-3 bg-white/50 dark:bg-white/5">
      <div class="flex items-center justify-between gap-3">
        <label class="text-xs text-gray-500 dark:text-gray-400">ูุญุฏุงุช ุงูุนูุฏ (ูููู ุงุฎุชูุงุฑ ุฃูุซุฑ ูู ูุญุฏุฉ)</label>
        <button class="btn-ui btn-secondary no-print" onclick="addLeaseUnitRow()" type="button">+ ุฅุถุงูุฉ ูุญุฏุฉ</button>
      </div>

      <div class="mt-2 overflow-auto">
        <table class="min-w-full text-sm text-right">
          <thead>
            <tr class="text-xs text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-gray-700">
              <th class="text-right py-2 px-2 w-2/3">ุงููุญุฏุฉ</th>
              <th class="text-right py-2 px-2 w-1/3">ุงูุฅูุฌุงุฑ ุงูุณููู (AED)</th>
              <th class="py-2 px-2 w-10"></th>
            </tr>
          </thead>
          <tbody id="add-lease-units-body"></tbody>
        </table>
      </div>

      <div class="mt-2 flex items-center justify-between text-sm">
        <div class="text-gray-600 dark:text-gray-300">ุฅุฌูุงูู ุงูุฅูุฌุงุฑ ุงูุณููู</div>
        <div class="font-extrabold text-gray-900 dark:text-white" id="add-lease-total-rent">0</div>
      </div>

      <div class="text-rose-600 text-sm mt-2" id="add-lease-units-error"></div>
    </div>
  </div>

  <!-- Panel: Tenant -->
  <div class="space-y-4 hidden" data-tab-panel="tenant">
    <input class="ui-field w-full" id="add-lease-tenant" placeholder="ุงุณู ุงููุณุชุฃุฌุฑ" required=""/>

    <div class="grid grid-cols-2 gap-3">
      <input class="ui-field w-full" id="add-lease-phone" placeholder="ุฑูู ุงููุงุชู"/>
      <input class="ui-field w-full" id="add-lease-email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" type="email"/>
    </div>

    <div>
      <label class="text-xs text-gray-500 dark:text-gray-400">ููุน ุงููุณุชุฃุฌุฑ</label>
      <select class="ui-field ui-select w-full" id="add-lease-tenantType">
        <option value="">ููุน ุงููุณุชุฃุฌุฑ...</option>
        <option value="company">ุดุฑูุฉ</option>
        <option value="individual">ูุฑุฏ</option>
      </select>
    </div>

    <div class="hidden" id="add-lease-companyFields">
      <input class="ui-field w-full" id="add-lease-tradeLicense" placeholder="ุฑูู ุงูุฑุฎุตุฉ ุงูุชุฌุงุฑูุฉ (ููุดุฑูุงุช)"/>
    </div>

    <div class="hidden" id="add-lease-personFields">
      <input class="ui-field w-full" id="add-lease-idNumber" placeholder="ุฑูู ุงููููุฉ (ููุฃูุฑุงุฏ)"/>
    </div>
  </div>

  <!-- Panel: Payments/Cheques -->
  <div class="space-y-4 hidden" data-tab-panel="payments">
    <div class="grid grid-cols-2 gap-3">
      <input class="ui-field w-full" id="add-lease-paymentsCount" min="0" placeholder="ุนุฏุฏ ุงูุฏูุนุงุช" type="number"/>
      <input class="ui-field w-full" id="add-lease-chequesCount" min="0" placeholder="ุนุฏุฏ ุงูุดููุงุช" type="number"/>
    </div>

    <!-- Optional: Schedule payments/cheques (adds them to registers as Pending) -->
    <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-3 bg-white/50 dark:bg-white/5" id="add-lease-schedule-box">
      <div class="flex items-center justify-between gap-3">
        <div>
          <div class="font-extrabold text-sm text-gray-800 dark:text-white">ุฌุฏููุฉ ุงูุฏูุนุงุช / ุงูุดููุงุช (ุงุฎุชูุงุฑู)</div>
          <div class="text-xs text-gray-500 dark:text-gray-400">ุณูุชู ุฅูุดุงุก ุณุฌูุงุช ุจุตูุฉ <span class="font-bold">ุจุงูุชุธุงุฑ ุงูุฏูุน</span> / <span class="font-bold">ุจุงูุชุธุงุฑ ุงูุตุฑู</span>.</div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-3">
        <label class="flex items-center gap-2 text-sm text-gray-700 dark:text-gray-200">
          <input type="checkbox" id="add-lease-schedule-payments" onchange="onAddLeaseScheduleChanged()" />
          ุฅูุดุงุก ุณุฌู ุฏูุนุงุช (ุจุงูุชุธุงุฑ ุงูุฏูุน)
        </label>
        <label class="flex items-center gap-2 text-sm text-gray-700 dark:text-gray-200">
          <input type="checkbox" id="add-lease-schedule-cheques" onchange="onAddLeaseScheduleChanged()" />
          ุฅูุดุงุก ุณุฌู ุดููุงุช (ุจุงูุชุธุงุฑ ุงูุตุฑู)
        </label>
      </div>

      <div class="hidden mt-3" id="add-lease-payplan-wrap">
        <div class="text-xs font-bold text-gray-600 dark:text-gray-300 mb-2">ุงูุฏูุนุงุช ุงููุฌุฏููุฉ</div>
        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead>
              <tr class="text-xs text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-gray-700">
                <th class="py-2 px-2 text-right w-10">#</th>
                <th class="py-2 px-2 text-right">ุงููุจูุบ (AED)</th>
                <th class="py-2 px-2 text-right">ุชุงุฑูุฎ ุงูุงุณุชุญูุงู</th>
                <th class="py-2 px-2 text-right">ุทุฑููุฉ ุงูุฏูุน</th>
              </tr>
            </thead>
            <tbody id="add-lease-payplan-body"></tbody>
          </table>
        </div>
        <div class="text-rose-600 text-sm mt-2" id="add-lease-payplan-error"></div>
      </div>

      <div class="hidden mt-3" id="add-lease-chqplan-wrap">
        <div class="text-xs font-bold text-gray-600 dark:text-gray-300 mb-2">ุงูุดููุงุช ุงููุฌุฏููุฉ</div>
        <div class="overflow-auto">
          <table class="min-w-full text-sm">
            <thead>
              <tr class="text-xs text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-gray-700">
                <th class="py-2 px-2 text-right w-10">#</th>
                <th class="py-2 px-2 text-right">ุฑูู ุงูุดูู</th>
                <th class="py-2 px-2 text-right">ุงููููุฉ (AED)</th>
                <th class="py-2 px-2 text-right">ุชุงุฑูุฎ ุงูุงุณุชุญูุงู</th>
                <th class="py-2 px-2 text-right">ุงูุจูู</th>
                <th class="py-2 px-2 text-right">ุงูุบุฑุถ</th>
                <th class="py-2 px-2 text-right">ุงููุญุฏุฉ</th>
              </tr>
            </thead>
            <tbody id="add-lease-chqplan-body"></tbody>
          </table>
        </div>
        <div class="text-rose-600 text-sm mt-2" id="add-lease-chqplan-error"></div>
      </div>
    </div>
  </div>

  <!-- Panel: Contract -->
  <div class="space-y-4 hidden" data-tab-panel="contract">
    <div class="grid grid-cols-2 gap-3">
      <input class="ui-field w-full" id="add-lease-bankGuarantee" min="0" placeholder="ูููุฉ ุงูุถูุงู ุงูุจููู" type="number"/>
      <input class="ui-field w-full" id="add-lease-contractNo" placeholder="ุฑูู ุงูุนูุฏ"/>
    </div>

    <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-3 bg-white/50 dark:bg-white/5">
  <div class="text-xs font-bold text-gray-700 dark:text-gray-300 mb-2">ูุฑูู ุงูุนูุฏ ุงูููุซู (ุงูุจูุฏูุฉ)</div>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
    <input class="ui-field w-full" id="add-lease-municipalityDocName" placeholder="ุงุณู ุงูููู (ุงุฎุชูุงุฑู)"/>
    <div class="flex gap-2">
      <input class="ui-field w-full" id="add-lease-municipalityDocPath" placeholder="ูุณุงุฑ/ุฑุงุจุท ุงูููู (ูุซุงู: Attachments/leases/&lt;contract_no&gt;/municipality_contract.pdf)"/>
      <button class="btn-ui btn-ui-sm btn-secondary" type="button" onclick="suggestLeaseMunicipalityPath('add')">ุงูุชุฑุงุญ</button>
    </div>
    <div class="flex flex-wrap gap-2 items-center mt-2">
      <input class="ui-field w-full md:w-auto hidden" id="add-lease-municipalityDocFile" type="file" accept="application/pdf,image/*" />
      <button class="btn-ui btn-ui-sm btn-primary" type="button" onclick="uploadLeaseMunicipalityDoc('add')">ุฑูุน</button>
      <button class="btn-ui btn-ui-sm btn-secondary" type="button" onclick="chooseAttachmentsRoot()">ุชุญุฏูุฏ ูุฌูุฏ ุงููุฑููุงุช</button>
    </div>

  </div>
  <div class="flex items-center justify-between text-[11px] text-gray-500 dark:text-gray-400 mt-2">
    <span>ูุชู ุญูุธ ุงูููู ุฏุงุฎู ูุฌูุฏ ุงููุฑููุงุช (ูุชุณุฌูู ุงููุณุงุฑ ุชููุงุฆูุงู).</span>
    <div class="flex items-center gap-3">
    <a id="add-lease-municipalityDocLink" class="text-blue-600 dark:text-blue-400 hover:underline hidden" href="#" target="_blank" rel="noopener">ูุชุญ</a>
    <a class="text-blue-600 dark:text-blue-400 hover:underline" href="#" onclick="openLeaseAttachmentsViewerFromModal('add'); return false;">ุนุฑุถ ูู ุงููููุงุช</a>
  </div>
  </div>
</div>

    <div class="grid grid-cols-2 gap-3">
      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุชุงุฑูุฎ ุงูุจุฏุก</label>
        <input class="ui-field w-full" id="add-lease-start" type="date"/>
      </div>
      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุชุงุฑูุฎ ุงูุงูุชูุงุก</label>
        <input class="ui-field w-full" id="add-lease-end" type="date"/>
      </div>
    </div>
  </div>

  <div class="text-rose-600 text-sm" id="add-lease-errors"></div>

  <div class="flex justify-end gap-3 pt-4 modal-footer-sticky">
    <button class="btn-ui btn-reset" onclick="closeAddLeaseModal()" type="button">ุฅูุบุงุก</button>
    <button class="btn-ui btn-success">ุฅูุดุงุก ุงูุนูุฏ</button>
  </div>
</form>

</div>
</div>

<div class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm" id="payment-modal">
<div class="modal-content modal-glass rounded-xl shadow-2xl w-full max-w-lg">
<form class="p-6 space-y-4" id="payment-form">
<h3 class="font-bold text-lg">ุชุณุฌูู ุฏูุนุฉ ุฌุฏูุฏุฉ</h3>
<input class="w-full border p-2 rounded" id="pay-date" required="" type="date"/>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ุงูุนูุฏ</label>
<select class="w-full border p-2 rounded" id="pay-contract"></select>
</div>
<select class="w-full border p-2 rounded" id="pay-type">
<option>ููุฏู</option>
<option>ุดูู</option>
<option>ุชุญููู ุจููู</option>
</select>
<input class="w-full border p-2 rounded font-bold text-lg" id="pay-amount" placeholder="ุงููุจูุบ (AED)" required="" type="number"/>
<input class="w-full border p-2 rounded" id="pay-desc" placeholder="ููุงุญุธุงุช / ูุตู"/>
<div class="flex justify-end gap-3 pt-4">
<button class="btn-ui btn-reset" onclick="closePaymentModal()" type="button">ุฅูุบุงุก</button>
<button class="btn-ui btn-success">ุญูุธ ุงูุฏูุนุฉ</button>
</div>
</form>
</div>
</div>

<div class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm" id="tenant-modal">
<div class="modal-content modal-glass rounded-xl shadow-2xl w-full max-w-md p-6">
<h3 class="font-bold text-lg mb-4">ุจูุงูุงุช ุงูุงุชุตุงู</h3>
<form class="space-y-4" id="tenant-form">
<input class="w-full border p-2 rounded bg-gray-100 dark:bg-gray-700" id="tenant-name" readonly=""/>
<input class="w-full border p-2 rounded" id="tenant-phone" placeholder="ุฑูู ุงููุงุชู"/>
<input class="w-full border p-2 rounded" id="tenant-email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู"/>
<select class="w-full border p-2 rounded" id="tenant-type">
<option value="">ููุน ุงููุณุชุฃุฌุฑ...</option>
<option value="company">ุดุฑูุฉ</option>
<option value="individual">ูุฑุฏ</option>
</select>
<div class="hidden" id="tenant-companyFields">
<input class="w-full border p-2 rounded" id="tenant-tradeLicense" placeholder="ุฑูู ุงูุฑุฎุตุฉ ุงูุชุฌุงุฑูุฉ (ููุดุฑูุงุช)"/>
<div class="mt-2 p-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-white/50 dark:bg-white/5">
  <div class="text-xs font-bold text-gray-700 dark:text-gray-300 mb-2">ูุฑูู ุงูุฑุฎุตุฉ ุงูุชุฌุงุฑูุฉ</div>
  <input class="w-full border p-2 rounded" id="tenant-tlDocName" placeholder="ุงุณู ููู ุงูุฑุฎุตุฉ (ุงุฎุชูุงุฑู)"/>
  <div class="flex gap-2 mt-2">
    <input class="w-full border p-2 rounded" id="tenant-tlDocPath" placeholder="ูุณุงุฑ/ุฑุงุจุท ููู ุงูุฑุฎุตุฉ (ูุซุงู: Attachments/tenants/&lt;tenant_key&gt;/trade_license.pdf)"/>
    <button class="btn-ui btn-ui-sm btn-secondary" onclick="suggestTenantDocPath('trade')" type="button">ุงูุชุฑุงุญ</button>
  </div>
  <div class="flex flex-wrap gap-2 items-center mt-2">
    <input class="border p-2 rounded w-full md:w-auto hidden" id="tenant-tlDocFile" type="file" accept="image/*,application/pdf" />
    <button class="btn-ui btn-ui-sm btn-primary" type="button" onclick="uploadTenantDoc('trade')">ุฑูุน</button>
    <button class="btn-ui btn-ui-sm btn-secondary" type="button" onclick="chooseAttachmentsRoot()">ุชุญุฏูุฏ ูุฌูุฏ ุงููุฑููุงุช</button>
  </div>

  <div class="flex items-center justify-between text-[11px] text-gray-500 dark:text-gray-400 mt-2">
    <span>ูุชู ุญูุธ ุงูููู ุฏุงุฎู ูุฌูุฏ ุงููุฑููุงุช (ูุชุณุฌูู ุงููุณุงุฑ ุชููุงุฆูุงู).</span>
    <div class="flex items-center gap-3">
    <a class="text-blue-600 dark:text-blue-400 hover:underline hidden" id="tenant-tlDocLink" href="#" target="_blank" rel="noopener">ูุชุญ</a>
    <a class="text-blue-600 dark:text-blue-400 hover:underline" href="#" onclick="openTenantAttachmentsViewer(); return false;">ุนุฑุถ ูู ุงููููุงุช</a>
  </div>
  </div>
</div>
</div>
<div class="hidden" id="tenant-personFields">
<input class="w-full border p-2 rounded" id="tenant-idNumber" placeholder="ุฑูู ุงููููุฉ (ููุฃูุฑุงุฏ)"/>
<div class="mt-2 p-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-white/50 dark:bg-white/5">
  <div class="text-xs font-bold text-gray-700 dark:text-gray-300 mb-2">ูุฑูู ุงููููุฉ</div>
  <input class="w-full border p-2 rounded" id="tenant-idDocName" placeholder="ุงุณู ููู ุงููููุฉ (ุงุฎุชูุงุฑู)"/>
  <div class="flex gap-2 mt-2">
    <input class="w-full border p-2 rounded" id="tenant-idDocPath" placeholder="ูุณุงุฑ/ุฑุงุจุท ุตูุฑุฉ ุงููููุฉ (ูุซุงู: Attachments/tenants/&lt;tenant_key&gt;/id_card.jpg)"/>
    <button class="btn-ui btn-ui-sm btn-secondary" onclick="suggestTenantDocPath('id')" type="button">ุงูุชุฑุงุญ</button>
  </div>
  <div class="flex flex-wrap gap-2 items-center mt-2">
    <input class="border p-2 rounded w-full md:w-auto hidden" id="tenant-idDocFile" type="file" accept="image/*,application/pdf" />
    <button class="btn-ui btn-ui-sm btn-primary" type="button" onclick="uploadTenantDoc('id')">ุฑูุน</button>
    <button class="btn-ui btn-ui-sm btn-secondary" type="button" onclick="chooseAttachmentsRoot()">ุชุญุฏูุฏ ูุฌูุฏ ุงููุฑููุงุช</button>
  </div>

  <div class="flex items-center justify-between text-[11px] text-gray-500 dark:text-gray-400 mt-2">
    <span>ูุชู ุญูุธ ุงูููู ุฏุงุฎู ูุฌูุฏ ุงููุฑููุงุช (ูุชุณุฌูู ุงููุณุงุฑ ุชููุงุฆูุงู).</span>
    <div class="flex items-center gap-3">
    <a class="text-blue-600 dark:text-blue-400 hover:underline hidden" id="tenant-idDocLink" href="#" target="_blank" rel="noopener">ูุชุญ</a>
    <a class="text-blue-600 dark:text-blue-400 hover:underline" href="#" onclick="openTenantAttachmentsViewer(); return false;">ุนุฑุถ ูู ุงููููุงุช</a>
  </div>
  </div>
</div>
</div>
<div class="flex justify-end gap-2 pt-2">
<button class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded text-gray-800" onclick="closeTenantModal()" type="button">ุฅุบูุงู</button>
<button class="btn-ui btn-success">ุญูุธ</button>
</div>
<div class="text-xs text-gray-500 text-right" id="tenant-save-status"></div>
</form>
</div>
</div>

<div class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm" id="cheque-modal">
<div class="modal-content modal-glass rounded-xl shadow-2xl w-full max-w-lg">
<form class="p-6 space-y-4" id="new-cheque-form">
<h3 class="font-bold text-lg border-b pb-2 dark:border-gray-600" id="cheque-modal-title">ุชุณุฌูู ุดูู ุฌุฏูุฏ</h3>
<input type="hidden" id="cheque-id"/>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ุงููุณุชุฃุฌุฑ</label>
<select class="w-full border p-2 rounded" id="cheque-tenant-select" onchange="toggleTenantInput()">
<option value="">ุงุฎุชุฑ ูุณุชุฃุฌุฑ ุญุงูู...</option>
<option value="other">-- ูุณุชุฃุฌุฑ ุฌุฏูุฏ / ุขุฎุฑ --</option>
</select>
<input class="w-full border p-2 rounded mt-2 hidden" id="cheque-tenant-manual" placeholder="ุฃุฏุฎู ุงุณู ุงููุณุชุฃุฌุฑ ูุฏููุงู"/>
</div>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ุงููุญุฏุฉ (ุงุฎุชูุงุฑู)</label>
<select class="w-full border p-2 rounded" disabled="" id="cheque-unit-select">
<option value="">โ ุจุฏูู ุฑุจุท ูุญุฏุฉ โ</option>
</select>
<p class="text-[11px] text-gray-500 dark:text-gray-400 mt-1">ูุชุญุณูู ุงูุชูุงุฑูุฑ ูุงุญุชุณุงุจ ุงููุชุฃุฎุฑุงุช ุจุฏูุฉุ ูููุถูู ุฑุจุท ุงูุดูู ุจูุญุฏุฉ ูุญุฏุฏุฉ.</p>
</div>
<div class="grid grid-cols-2 gap-2">
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ุฑูู ุงูุดูู</label>
<input class="w-full border p-2 rounded" id="cheque-number" required=""/>
</div>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ุงููููุฉ</label>
<input class="w-full border p-2 rounded" id="cheque-value" required="" type="number"/>
</div>
</div>
<div class="grid grid-cols-2 gap-2">
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ุชุงุฑูุฎ ุงูุงุณุชุญูุงู</label>
<input class="w-full border p-2 rounded" id="cheque-due-date" required="" type="date"/>
</div>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ุงูุจูู</label>
<input class="w-full border p-2 rounded" id="cheque-bank"/>
</div>
</div>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400 block mb-1">ุตูุฑุฉ ุงูุดูู (ุงุฎุชูุงุฑู)</label>
<input accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100" id="cheque-image" type="file"/>
</div>
<div class="flex items-center justify-between gap-2 -mt-2">
  <div class="text-[11px] text-gray-500 dark:text-gray-400">ูุฑููุงุช ุงูุดูู (ุญูุธ ุฏุงุฎู ูุฌูุฏ ุงููุฑููุงุช)</div>
  <div class="flex items-center gap-2">
    <button type="button" class="btn-ui btn-ui-sm btn-secondary" onclick="openChequeAttachmentsViewerFromModal()" title="ุนุฑุถ ุงููููุงุช">๐ ุนุฑุถ</button>
    <button type="button" class="btn-ui btn-ui-sm btn-secondary" onclick="uploadChequeAttachmentsFromModal()" title="ุฑูุน ูููุงุช">โฌ๏ธ ุฑูุน</button>
  </div>
</div>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ููุงุญุธุงุช</label>
<input class="w-full border p-2 rounded" id="cheque-purpose"/>
</div>
<div class="flex justify-end gap-3 pt-4 border-t dark:border-gray-700">
<button class="btn-ui btn-reset" onclick="closeChequeModal()" type="button">ุฅูุบุงุก</button>
<button class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded" id="cheque-modal-save-btn">ุญูุธ ุงูุดูู</button>
</div>
</form>
</div>
<!-- ============= CHEQUE LINK MODAL (Link cheque to unit) ============= -->
<div class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm" id="cheque-link-modal">
<div class="modal-content modal-glass rounded-xl shadow-2xl w-full max-w-lg">
<div class="p-6 space-y-4">
<h3 class="font-bold text-lg border-b pb-2 dark:border-gray-600">ุฑุจุท ุงูุดูู ุจูุญุฏุฉ</h3>
<div class="text-sm text-gray-600 dark:text-gray-300" id="cheque-link-info"></div>
<div>
<label class="text-xs text-gray-500 dark:text-gray-400">ุงุฎุชุฑ ุงููุญุฏุฉ</label>
<select class="w-full border p-2 rounded" id="cheque-link-unit-select"></select>
<p class="text-[11px] text-gray-500 dark:text-gray-400 mt-1">ุงูุฑุจุท ูุณุงุนุฏ ูู ุงุญุชุณุงุจ ุงููุชุฃุฎุฑุงุช ูุงูุชูุงุฑูุฑ ุงูุฎุงุตุฉ ุจูู ูุญุฏุฉ.</p>
</div>
<div class="flex justify-end gap-3 pt-4 border-t dark:border-gray-700">
<button class="btn-ui btn-reset" onclick="closeChequeLinkModal()" type="button">ุฅูุบุงุก</button>
<button class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded" onclick="confirmChequeLink()" type="button">ุญูุธ ุงูุฑุจุท</button>
</div>
</div>
</div>
</div>
<!-- Lease Payment Modal (Multi-unit contract payments) -->
<div class="fixed inset-0 z-50 hidden" id="lease-payment-modal">
<div class="absolute inset-0 bg-black/40"></div>
<div class="modal-content relative max-w-4xl mx-auto mt-10 bg-white dark:bg-dark-surface rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden">
<div class="p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between gap-3">
<div class="font-extrabold text-gray-800 dark:text-white" id="lease-pay-title">ุชุณุฌูู ุฏูุนุฉ</div>
<button class="px-3 py-1.5 rounded-lg text-sm font-bold bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600" onclick="document.getElementById('lease-payment-modal').classList.add('hidden')">ุฅุบูุงู</button>
</div>
<div class="p-4 max-h-[70vh] overflow-auto">
<div class="grid grid-cols-1 md:grid-cols-4 gap-3">
<div>
<label class="block text-xs text-gray-500 dark:text-gray-400 mb-1">ุชุงุฑูุฎ ุงูุฏูุนุฉ</label>
<input class="w-full px-3 py-2 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-surface" id="lease-pay-date" type="date"/>
</div>
<div>
<label class="block text-xs text-gray-500 dark:text-gray-400 mb-1">ุงููุจูุบ ุงูุฅุฌูุงูู</label>
<input class="w-full px-3 py-2 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-surface" id="lease-pay-total" oninput="onLeasePayTotalChange()" placeholder="ูุซุงู: 190000" type="text"/>
</div>
<div>
<label class="block text-xs text-gray-500 dark:text-gray-400 mb-1">ุทุฑููุฉ ุงูุฏูุน</label>
<select class="w-full px-3 py-2 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-surface" id="lease-pay-method">
<option>ุชุญููู</option>
<option>ููุฏ</option>
<option>ุดูู</option>
<option>ุฃุฎุฑู</option>
</select>
</div>
<div>
<label class="block text-xs text-gray-500 dark:text-gray-400 mb-1">ูุฑุฌุน</label>
<input class="w-full px-3 py-2 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-dark-surface" id="lease-pay-ref" placeholder="ุฑูู ุญูุงูุฉ / ุดูู" type="text"/>
</div>
</div>
<div class="mt-4 flex items-center justify-between gap-3">
<div class="text-sm font-bold text-gray-700 dark:text-gray-200">
            ูุฌููุน ุงูุชูุฒูุน: <span class="font-mono" id="lease-pay-sum">0 AED</span>
<span class="mx-2">|</span>
            ุงููุฑู: <span class="font-mono text-red-600 dark:text-red-300" id="lease-pay-diff">0 AED</span>
</div>
<div class="flex items-center gap-2">
<button class="px-3 py-2 rounded-xl bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-sm font-bold" onclick="autoDistributeLeasePayment()">ุชูุฒูุน ุชููุงุฆู</button>
</div>
</div>
<div class="mt-3 rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden">
<div class="bg-gray-50 dark:bg-gray-800 px-3 py-2 text-sm font-extrabold text-gray-700 dark:text-gray-200">ุชูุฒูุน ุงูุฏูุนุฉ ุนูู ุงููุญุฏุงุช</div>
<div class="overflow-x-auto">
<table class="min-w-full text-right text-sm">
<thead class="bg-white dark:bg-dark-surface">
<tr class="text-xs text-gray-500 dark:text-gray-400">
<th class="py-2 px-2">ุงููุญุฏุฉ</th>
<th class="py-2 px-2">ุฅูุฌุงุฑ ุงููุญุฏุฉ</th>
<th class="py-2 px-2">ุงููุณุชูู ุณุงุจูุงู</th>
<th class="py-2 px-2">ุงููุชุจูู</th>
<th class="py-2 px-2">ูุจูุบ ูุฎุตุต</th>
</tr>
</thead>
<tbody id="lease-pay-units-body"></tbody>
</table>
</div>
</div>
<div class="mt-4 flex items-center justify-end gap-2">
<button class="px-4 py-2 rounded-xl bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 font-bold" onclick="document.getElementById('lease-payment-modal').classList.add('hidden')">ุฅูุบุงุก</button>
<button class="px-4 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white font-extrabold" onclick="saveLeasePayment()">ุญูุธ ุงูุฏูุนุฉ</button>
</div>
</div>
</div>
</div>
</div>


<!-- Lease Archive Modal (Manual) -->
<div class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm" id="lease-archive-modal">
  <div class="modal-content modal-glass rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden">
    <div class="modal-header-glass p-6 border-b bg-gray-50 dark:bg-gray-700 dark:border-gray-600 flex justify-between items-center">
      <h3 class="text-xl font-bold">ุฃุฑุดูุฉ ุงูุนูุฏ</h3>
      <button class="text-gray-400 hover:text-gray-600 dark:hover:text-white" type="button" onclick="closeLeaseArchiveModal()">โ</button>
    </div>

    <form id="lease-archive-form" class="p-6 grid grid-cols-1 gap-4">
      <input type="hidden" id="lease-archive-groupkey" />

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุณุจุจ ุงูุฃุฑุดูุฉ</label>
        <select class="ui-field ui-select" id="lease-archive-action" required>
          <option value="">ุงุฎุชุฑ ุงูุณุจุจ...</option>
          <option value="cancel">ุฅูุบุงุก ุงูุนูุฏ</option>
          <option value="vacate">ุฅุฎูุงุก ุงููุญุฏุฉ</option>
        </select>
        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">ุณูุชู ููู ุงูุนูุฏ ุฅูู ุงูุฃุฑุดูู ูุชุญููู ุงููุญุฏุฉ/ุงููุญุฏุงุช ุฅูู ุดุงุบุฑุฉ.</p>
      </div>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ููุงุญุธุฉ (ุงุฎุชูุงุฑู)</label>
        <textarea class="ui-field ui-input" id="lease-archive-note" rows="3" placeholder="ูุซุงู: ุงูุชูุงุก ุงูุนูุฏ ูุชู ุฅุฎูุงุก ุงููุญุฏุฉ ุจุชุงุฑูุฎ..." ></textarea>
      </div>

      <div class="modal-actions flex justify-end gap-3 mt-2">
        <button class="btn-ui btn-reset" type="button" onclick="closeLeaseArchiveModal()">ุฅูุบุงุก</button>
        <button class="btn-ui btn-danger" type="submit">ุฃุฑุดูุฉ</button>
      </div>
    </form>
  </div>
</div>


<!-- ===================== Police/Court Cases Modals ===================== -->

<div class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm" id="case-modal">
  <div class="modal-content modal-glass rounded-2xl shadow-2xl w-full max-w-3xl overflow-hidden">
    <div class="modal-header-glass p-6 border-b bg-gray-50 dark:bg-gray-700 dark:border-gray-600 flex justify-between items-center">
      <h3 id="case-modal-title" class="text-xl font-bold">ุฅุถุงูุฉ ุจูุงุบ/ุฏุนูู</h3>
      <button class="text-gray-400 hover:text-gray-600" onclick="closeCaseModal()" type="button">โ</button>
    </div>

    <form class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4" id="case-form" onsubmit="saveCaseFromModal(event)">
      <input id="case-id" type="hidden"/>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงูููุน</label>
        <select class="border p-2 rounded w-full" id="case-type" required>
          <option value="ุจูุงุบ">ุจูุงุบ ุดุฑุทุฉ</option>
          <option value="ุฏุนูู">ุฏุนูู ูุถุงุฆูุฉ</option>
        </select>
      </div>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงูุญุงูุฉ</label>
        <select class="border p-2 rounded w-full" id="case-status" required>
          <option value="ููุชูุญุฉ">ููุชูุญุฉ</option>
          <option value="ููุฏ ุงููุชุงุจุนุฉ">ููุฏ ุงููุชุงุจุนุฉ</option>
          <option value="ูุบููุฉ">ูุบููุฉ</option>
        </select>
      </div>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุฑูู ุงูุจูุงุบ/ุงููุถูุฉ</label>
        <input class="border p-2 rounded w-full font-mono" id="case-number" placeholder="ูุซุงู: 12345/2026" required/>
      </div>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุชุงุฑูุฎ ุงูุจูุงุบ/ุงููุถูุฉ</label>
        <input class="border p-2 rounded w-full" id="case-date" type="date" required/>
      </div>

      <div class="md:col-span-2">
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงูุฌูุฉ/ุงููุญููุฉ</label>
        <input class="border p-2 rounded w-full" id="case-authority" placeholder="ุดุฑุทุฉ ุฏุจู / ูุญููุฉ ุฏุจู..." />
      </div>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงูุนูุงุฑ</label>
        <select class="border p-2 rounded w-full" id="case-property" onchange="onCasePropertyChanged()">
          <option value="">โ ุงุฎุชูุงุฑู โ</option>
        </select>
      </div>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงููุญุฏุฉ</label>
        <select class="border p-2 rounded w-full" id="case-unit" onchange="onCaseUnitChanged()">
          <option value="">โ ุงุฎุชูุงุฑู โ</option>
        </select>
      </div>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงููุณุชุฃุฌุฑ</label>
        <input class="border p-2 rounded w-full" id="case-tenant" list="tenants-datalist" placeholder="ุงุฎุชูุงุฑู"/>
      </div>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุฑูู ุงูุนูุฏ</label>
        <input class="border p-2 rounded w-full font-mono" id="case-contractNo" placeholder="ุงุฎุชูุงุฑู"/>
      </div>

      <div class="md:col-span-2">
        <label class="text-xs text-gray-500 dark:text-gray-400">ุนููุงู ูุฎุชุตุฑ</label>
        <input class="border p-2 rounded w-full" id="case-title" placeholder="ูุซุงู: ูุชุฃุฎุฑุงุช ุฅูุฌุงุฑ / ุฅุฎูุงู ุจุงูุดุฑูุท..." />
      </div>

      <div class="md:col-span-2">
        <label class="text-xs text-gray-500 dark:text-gray-400">ููุงุญุธุงุช</label>
        <textarea class="border p-2 rounded w-full" id="case-notes" rows="3" placeholder="ุชูุงุตูู ูุฎุชุตุฑุฉ..."></textarea>
      </div>
      <div class="md:col-span-2">
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงููุฑููุงุช (ุงุฎุชูุงุฑู)</label>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <input class="border p-2 rounded w-full" id="case-attach-name" placeholder="ุงุณู ุงูููู (ุงุฎุชูุงุฑู)"/>
          <input class="border p-2 rounded w-full font-mono" id="case-attach-path" placeholder="ูุณุงุฑ/ุฑุงุจุท (ูุซุงู: Attachments/cases/CASE_.../file.pdf)"/>
        <div class="md:col-span-2 flex flex-wrap gap-2 items-center mt-2">
          <input class="border p-2 rounded w-full md:w-auto hidden" id="case-attach-files" type="file" multiple accept="application/pdf,image/*" />
          <button type="button" class="btn-ui btn-ui-sm btn-primary" onclick="uploadCaseModalFiles()">ุฑูุน</button>
          <button type="button" class="btn-ui btn-ui-sm btn-secondary" onclick="chooseAttachmentsRoot()">ุชุญุฏูุฏ ูุฌูุฏ ุงููุฑููุงุช</button>
          <span class="text-[11px] text-gray-500 dark:text-gray-400">ุณูุชู ุญูุธ ุงููููุงุช ุฏุงุฎู ูุฌูุฏ ุงููุฑููุงุช ุงููุฎุชุงุฑ.</span>
        </div>

        </div>

        <div class="flex justify-end mt-2">
          <button type="button" class="btn-ui btn-ui-sm btn-secondary" onclick="addCaseModalAttachment()">+ ุฅุถุงูุฉ ูุฑูู</button>
        </div>

        <input id="case-attachments-json" type="hidden" value="[]"/>
        <div id="case-attachments-list" class="mt-2 space-y-2"></div>

        <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">
          ููุงุญุธุฉ: ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ <span class="font-semibold">ุฑูุน</span> ุณูุชู ุงุฎุชูุงุฑ ุงููููุงุช ูุญูุธูุง ุชููุงุฆูุงู ุฏุงุฎู <span class="font-mono">Attachments</span> ุญุณุจ ุฑูู ุงููุญุฏุฉ/ุงููุณุชุฃุฌุฑ/ุงููุถูุฉ.
        </p>
      </div>
<div class="md:col-span-2 flex justify-end gap-3 mt-2">
        <button class="btn-ui btn-reset" onclick="closeCaseModal()" type="button">ุฅูุบุงุก</button>
        <button class="btn-ui btn-success" type="submit">ุญูุธ</button>
      </div>
    </form>
  </div>
</div>

<div class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm" id="case-update-modal">
  <div class="modal-content modal-glass rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden">
    <div class="modal-header-glass p-6 border-b bg-gray-50 dark:bg-gray-700 dark:border-gray-600 flex justify-between items-center">
      <h3 id="case-update-modal-title" class="text-xl font-bold">ุฅุถุงูุฉ ุชุทูุฑ</h3>
      <button class="text-gray-400 hover:text-gray-600" onclick="closeCaseUpdateModal()" type="button">โ</button>
    </div>

    <form class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4" id="case-update-form" onsubmit="saveCaseUpdateFromModal(event)">
      <input id="case-update-id" type="hidden"/>
      <input id="case-update-caseId" type="hidden"/>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงูููุน</label>
        <select class="border p-2 rounded w-full" id="case-update-type" required>
          <option value="note">ูุฐูุฑุฉ/ูุญุถุฑ</option>
          <option value="fee">ุฑุณูู/ุบุฑุงูุฉ</option>
          <option value="judgement">ุญูู/ูุฑุงุฑ</option>
          <option value="document">ูุณุชูุฏ</option>
        </select>
      </div>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงูุชุงุฑูุฎ</label>
        <input class="border p-2 rounded w-full" id="case-update-date" type="date" required/>
      </div>

      <div class="md:col-span-2">
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงูุนููุงู</label>
        <input class="border p-2 rounded w-full" id="case-update-title" placeholder="ุงุฎุชูุงุฑู"/>
      </div>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงููุจูุบ (ุฅู ูุฌุฏ)</label>
        <input class="border p-2 rounded w-full" id="case-update-amount" type="number" placeholder="0"/>
      </div>
      <div class="md:col-span-2">
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงููุฑููุงุช (ุงุฎุชูุงุฑู)</label>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <input class="border p-2 rounded w-full" id="case-update-attach-name" placeholder="ุงุณู ุงูููู (ุงุฎุชูุงุฑู)"/>
          <input class="border p-2 rounded w-full font-mono" id="case-update-attach-path" placeholder="ูุณุงุฑ/ุฑุงุจุท (ูุซุงู: Attachments/cases/CASE_.../file.pdf)"/>
        <div class="md:col-span-2 flex flex-wrap gap-2 items-center mt-2">
          <input class="border p-2 rounded w-full md:w-auto hidden" id="case-update-attach-files" type="file" multiple accept="application/pdf,image/*" />
          <button type="button" class="btn-ui btn-ui-sm btn-primary" onclick="uploadCaseUpdateModalFiles()">ุฑูุน</button>
          <button type="button" class="btn-ui btn-ui-sm btn-secondary" onclick="chooseAttachmentsRoot()">ุชุญุฏูุฏ ูุฌูุฏ ุงููุฑููุงุช</button>
        </div>

        </div>

        <div class="flex justify-end mt-2">
          <button type="button" class="btn-ui btn-ui-sm btn-secondary" onclick="addCaseUpdateModalAttachment()">+ ุฅุถุงูุฉ ูุฑูู</button>
        </div>

        <input id="case-update-attachments-json" type="hidden" value="[]"/>
        <div id="case-update-attachments-list" class="mt-2 space-y-2"></div>
      </div>
<div class="md:col-span-2">
        <label class="text-xs text-gray-500 dark:text-gray-400">ุชูุงุตูู</label>
        <textarea class="border p-2 rounded w-full" id="case-update-note" rows="3" placeholder="ุงูุชุจ ุงูุชุทูุฑ ุจุงูุชูุตูู..."></textarea>
<div class="md:col-span-2 flex justify-end gap-3 mt-2">
        <button class="btn-ui btn-reset" onclick="closeCaseUpdateModal()" type="button">ุฅูุบุงุก</button>
        <button class="btn-ui btn-success" type="submit">ุญูุธ</button>
      </div>
    </form>
  </div>
</div>

<div class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm" id="case-event-modal">
  <div class="modal-content modal-glass rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden">
    <div class="modal-header-glass p-6 border-b bg-gray-50 dark:bg-gray-700 dark:border-gray-600 flex justify-between items-center">
      <h3 id="case-event-modal-title" class="text-xl font-bold">ุฅุถุงูุฉ ููุนุฏ/ุฌูุณุฉ</h3>
      <button class="text-gray-400 hover:text-gray-600" onclick="closeCaseEventModal()" type="button">โ</button>
    </div>

    <form class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4" id="case-event-form" onsubmit="saveCaseEventFromModal(event)">
      <input id="case-event-id" type="hidden"/>
      <input id="case-event-caseId" type="hidden"/>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ููุน ุงูููุนุฏ</label>
        <select class="border p-2 rounded w-full" id="case-event-type" required>
          <option value="police_review">ูุฑุงุฌุนุฉ ุดุฑุทุฉ</option>
          <option value="court_session">ุฌูุณุฉ ูุญููุฉ</option>
        </select>
      </div>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงูุชุงุฑูุฎ</label>
        <input class="border p-2 rounded w-full" id="case-event-date" type="date" required/>
      </div>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงูููุช (ุงุฎุชูุงุฑู)</label>
        <input class="border p-2 rounded w-full" id="case-event-time" type="time"/>
      </div>

      <div>
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงูุนููุงู</label>
        <input class="border p-2 rounded w-full" id="case-event-title" placeholder="ูุซุงู: ุฌูุณุฉ ุงุณุชูุงุน / ูุฑุงุฌุนุฉ ูุญุถุฑ..." required/>
      </div>

      <div class="md:col-span-2">
        <label class="text-xs text-gray-500 dark:text-gray-400">ุงูุชูุจูู ูุจู</label>
        <div class="flex flex-wrap gap-3">
          <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="case-rem-7" checked/> 7 ุฃูุงู</label>
          <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="case-rem-3" checked/> 3 ุฃูุงู</label>
          <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="case-rem-1" checked/> ููู</label>
        </div>
      </div>

      <div class="md:col-span-2">
        <label class="text-xs text-gray-500 dark:text-gray-400">ููุงุญุธุงุช</label>
        <textarea class="border p-2 rounded w-full" id="case-event-notes" rows="2" placeholder="ุงุฎุชูุงุฑู..."></textarea>
<div class="md:col-span-2 flex justify-end gap-3 mt-2">
        <button class="btn-ui btn-reset" onclick="closeCaseEventModal()" type="button">ุฅูุบุงุก</button>
        <button class="btn-ui btn-success" type="submit">ุญูุธ</button>
      </div>
    </form>
  </div>
</div>



<!-- ===== Attachments Viewer (generic) ===== -->
<div class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm" id="attachments-viewer-modal">
  <div class="modal-content modal-glass rounded-xl shadow-2xl w-full max-w-5xl">
    <div class="p-4 border-b dark:border-gray-600 flex flex-wrap items-center justify-between gap-3">
      <div class="min-w-0">
        <div class="font-extrabold text-lg text-gray-800 dark:text-white" id="attachments-viewer-title">ุงููุฑููุงุช</div>
        <div class="text-[11px] font-mono text-gray-500 dark:text-gray-400 break-all" id="attachments-viewer-path">Attachments/</div>
      </div>
      <div class="flex flex-wrap items-center gap-2">
        <button type="button" class="btn-ui btn-ui-sm btn-secondary" onclick="refreshAttachmentsViewer()">ุชุญุฏูุซ</button>
        <button type="button" class="btn-ui btn-ui-sm btn-secondary" onclick="chooseAttachmentsRoot()">ุชุญุฏูุฏ ูุฌูุฏ ุงููุฑููุงุช</button>
        <button type="button" class="btn-ui btn-ui-sm btn-danger" onclick="closeAttachmentsViewer()">ุฅุบูุงู</button>
      </div>
    </div>

    <div class="p-4 grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="md:col-span-1">
        <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">ุงููููุงุช ุฏุงุฎู ุงููุณุงุฑ</div>
        <div id="attachments-viewer-list" class="space-y-2 max-h-[65vh] overflow-auto"></div>
      </div>
      <div class="md:col-span-2">
        <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">ุงููุนุงููุฉ</div>
        <div id="attachments-viewer-preview" class="min-h-[220px] p-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-white/60 dark:bg-gray-900/30"></div>
      </div>
    </div>
  </div>
</div>

<datalist id="tenants-datalist"></datalist>
